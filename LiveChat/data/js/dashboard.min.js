function initialize(){window.map=new google.maps.Map(document.getElementById("map"),{zoom:2,minZoom:1,maxZoom:4,center:{lat:0,lng:0},mapTypeId:google.maps.MapTypeId.TERRAIN})}function addMarkers(e){for(var s="",r="http://maps.google.com/mapfiles/ms/icons/red-dot.png",a="http://maps.google.com/mapfiles/ms/icons/green-dot.png",t="http://maps.google.com/mapfiles/ms/icons/blue-dot.png",l=new google.maps.InfoWindow,o=new google.maps.LatLngBounds,n=0;n<e.length;n++)"request"==e[n][3]&&(s=r),"in_progress"==e[n][3]&&(s=a),"visitor"==e[n][3]&&(s=t),marker=new google.maps.Marker({position:new google.maps.LatLng(e[n][1],e[n][2]),map:map,icon:s}),markers.push(marker),o.extend(marker.position),google.maps.event.addListener(marker,"click",function(s,r){return function(){l.setContent(e[r][0]),l.open(map,s)}}(marker,n));map.fitBounds(o)}function deleteMarkers(){for(var e=0;e<markers.length;e++)markers[e].setMap(null)}function updateMap(){var e=sessionStorage.getItem("ultimate_support_chat-jsSession--loggedUsersResults"),s=JSON.parse(e);if(("null"!=s&&null==s||"null"==s.all_users||null==s.all_users||0==s.all_users.length)&&(chat_locations=[]),("null"!=s&&null==s||"null"==s.tracked_users||null==s.tracked_users||0==s.tracked_users.length)&&(visitors_locations=[]),"null"!=s&&null!=s&&"null"!=s.all_users&&null!=s.all_users&&0!=s.all_users.length){var r=0;chat_locations=[];for(var a in s.all_users){if(s.all_users.hasOwnProperty(a)&&""!=s.all_users[a].latitude&&"0"!=s.all_users[a].latitude&&!isNaN(s.all_users[a].latitude)){var t="";t+="<b>Name :</b> "+s.all_users[a].name.toUpperCase().replace("_"," ")+"<br />",t+="<b>IP Address :</b> "+s.all_users[a].ip_address+"<br />";var l=s.all_users[a].country_name;"-"!=s.all_users[a].country_name&&(l+='<img class="tip_tip" title="'+s.all_users[a].country_name+'" style="margin-top:-2px; margin-left:10px" src="'+dataServer+"/img/countries/"+s.all_users[a].country_code.toLocaleLowerCase()+'.png"/>'),t+="<b>Location :</b> "+l+"<br />",t+="<b>Browser :</b> "+s.all_users[a].browser+"<br />",t+="<b>Platform :</b> "+s.all_users[a].os+"<br />",t+="<b>Screen :</b> "+s.all_users[a].screen_size+"<br />",0==s.all_users[a].in_chat&&(t+='<br/><a style="cursor:pointer" onclick="loadChat('+s.all_users[a].request_id+')">Reply to chat</a>',chat_locations[r]=[t,s.all_users[a].latitude,s.all_users[a].longitude,"request",r]),1==s.all_users[a].in_chat&&(t+='<br/><a style="cursor:pointer" onclick="loadChat('+s.all_users[a].request_id+')">Chat in progress</a>',chat_locations[r]=[t,s.all_users[a].latitude,s.all_users[a].longitude,"in_progress",r])}r++}}if("null"!=s&&null!=s&&"null"!=s.tracked_users&&null!=s.tracked_users&&0!=s.tracked_users.length){var o=0;visitors_locations=[];for(var n in s.tracked_users){if(s.tracked_users.hasOwnProperty(n)&&""!=s.tracked_users[n].latitude&&"0"!=s.tracked_users[n].latitude&&!isNaN(s.tracked_users[n].latitude)){var i="";i+="<b>Guest visitor</b><br />",i+="<b>IP Address :</b> "+s.tracked_users[n].ip_address+"<br />";var u=s.tracked_users[n].country_name;"-"!=s.tracked_users[n].country_name&&(u+='<img class="tip_tip" title="'+s.tracked_users[n].country_name+'" style="margin-top:-2px; margin-left:10px" src="'+dataServer+"/img/countries/"+s.tracked_users[n].country_code.toLocaleLowerCase()+'.png"/>'),i+="<b>Location :</b> "+u+"<br />",i+="<b>Browser :</b> "+s.tracked_users[n].browser+"<br />",i+="<b>Platform :</b> "+s.tracked_users[n].os+"<br />",i+="<b>Screen :</b> "+s.tracked_users[n].screen_size+"<br />",visitors_locations[o]=[i,s.tracked_users[n].latitude,s.tracked_users[n].longitude,"visitor",o]}o++}}merged_locations=chat_locations.concat(visitors_locations),merged_locations.length>0?addMarkers(merged_locations):(deleteMarkers(),map.setZoom(2))}function loadChat(e){validNavigation=!0,window.location.href=applicationPath+"visitors/chat?request="+e}function inviteChat(e){validNavigation=!0;var s=confirm("Invite this visitor to a chat?");s===!0&&$.ajax({url:applicationPath+"modules/users/ajax/operator_actions.php",type:"POST",data:{user_id:e,invite_user:"true"},cache:!1,success:function(e){}})}var map,marker,markers=[],chat_locations=[],visitors_locations=[],merged_locations=[];initialize(),updateMap(),setInterval(function(){updateMap()},2500);